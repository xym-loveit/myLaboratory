# JVM调优
### Java虚拟机内存模型  
JVM虚拟机将其内存分为：程序计数器、虚拟机栈、本地方法栈、Java堆、方法区  
* 程序计数器：用于存放下一条运行的指令
* 虚拟机栈和本地方法栈：用于存放函数调用堆栈信息
* Java堆：用于存放Java程序运行时所需的对象数据
* 方法区：用于存放程序的类元数据信息


##### 虚拟机栈中的局部变量表中的字（局部变量表以字为单位进行内存的划分，一个字为32位长度）可能会影响GC回收，如果这个字没有被后续代码复用，那么他所引用的对象不会被GC释放。  

##### 本地方法栈：本地方法栈与Java虚拟机的功能很相似，Java虚拟机栈用于管理Java函数的调用，而本地方法栈用于管理本地方法的调用。本地方法并不是用Java实现，而是使用C语言实现的。在SUN的Hot Spot虚拟机中，不区分本地方法栈和虚拟机栈。因此，和虚拟机栈一样，它也会抛出StackOverflowError和OutOfMemoryError。

# JVM内存分配参数  
* -Xmx（最大堆内存），新生代和老年代大小之和的最大值，它是java应用程序的堆上限。

* -Xms（最小堆内存），设置系统最小堆内存，JVM会试图将系统内存尽可能限制在-Xms中，因此，当内存实际使用量触及-Xms指定的大小时，会触发Full GC,因此把-Xms值设置为-Xmx时，可以在系统运行初期减少GC的次数和耗时。

* -Xmn（新生代大小），新生代大小一般为整个堆空间的1/4到1/3左右。（e.g. -Xmx11M -Xms11M -Xmn2M -XX:+PrintGCDetails的最佳Xmn为3.5M）
-Xmx11M -Xms11M -Xmn2M -XX:+PrintGCDetails 偏小  Minor GC次数将增加  （不要这样做）
-Xmx11M -Xms11M -Xmn3.5M -XX:+PrintGCDetails 最佳  Minor GC次数将最少 （按正常比例配置最佳参数，推荐）

* -XX:MaxPermSize（设置持久代最大值）、-XX:PermSize（设置持久代初始大小），持久代的大小直接决定了系统可以支持多少个类定义和多少常量。对于使用CGLIB或Javassist等动态字节码生成工具的应用程序而言，设置合理的持久代大小有助于维持系统稳定。一般推荐最佳参数为64M/128M

* -Xss（设置线程栈大小），如果系统确实需要大量线程并发执行，那么设置一个较小的堆和较小的栈，有助于提高系统所能承受的最大线程数。

#### 堆的比例分配  
参数-XX:SurvivorRatio是用来设置新生代中，eden空间和s0空间的比例关系。s0和s1空间又分别称为form空间和to空间。它们的大小是相同的，职能也是一样的，并在Minor GC后，会互换角色。  
```
-XX:SurvivorRatio=eden/s0=eden/s1
```
-XX:NewRatio可以设置老年代与新生代的比例,可以使用-XX:+PrintGCDetails参数打印出堆的实际大小。




